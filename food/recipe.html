<!DOCTYPE html>
<html>
    <head>
        <title>Recipes</title>
    </head>
    <body>
        <a href="/food/add-recipe">Add Recipe</a>
        <REPLACE id="ongoing"/>
        <REPLACE id="table"/>

        <input type="button" value="Start selected" onclick="startRecipe()">

        <script>
            function cbToggled(e) {
                console.log(e);
                var id = e.target.id;
                var inp = document.getElementById("delay-" + id);
                inp.style.display = e.target.checked ? "" : "none";
            }
            function startRecipe() {
                var doing = {};
                var selects = document.getElementsByClassName("recipe-selects");
                for(let x of selects) {
                    if(x.checked) {
                        var offset = document.getElementById("delay-" + x.id);
                        console.log(x, offset);
                        doing[parseInt(x.id)] = parseInt(offset.value || 0);
                    }
                }
                console.log(doing);

                fetch(`/api/food/recipes`, {
                    method: 'PUT',
                    body: JSON.stringify(doing)
                }).then(function(resp) {
                    console.log(resp);
                    if(resp.ok) {
                        resp.text().then(function(t) {
                            window.location = `/food/ongoing-recipe?id=${t}`;
                        })
                    }
                }).catch(function(err) {
                    console.log(err);
                })
            }
            function deleteRecipe(id) {
                var x = prompt("Are you sure you want to delete this? Type yes to continue", "")
                if(x !== "yes")
                    return;
                fetch(`/api/food/recipe?id=${id}`, {method: "DELETE"}).then(function(resp) {
                    console.log(resp);
                    if(resp.ok) {
                        window.location.reload();
                    } else {
                        console.error(resp);
                    }
                }).catch(function(err) {
                    console.error(err);
                })
            }
        </script>
    </body>
</html>