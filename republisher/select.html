<!DOCTYPE html>
<html>
    <head>
        <title>Select posts to republish</title>
        <style>
            .column {
                float: left;
                width: 50%;
            }
            /* Clear floats after the columns */
            .container:after {
                content: "";
                display: table;
                clear: both;
            }
            div.error {
                border: 1px solid red;
                background-color: rgba(255, 0, 0, 0.2);
            }
        </style>
    </head>
    <body>
        <REPLACE id="content"/>

        <script>

            function redirectErr(urlOrEvent) {
                var url = "";
                if(typeof(urlOrEvent) === "string") {
                    url = urlOrEvent;
                } else {
                    url = urlOrEvent.currentTarget.getAttribute("data-url");
                }
                var domain = new URL(url).hostname;
                if(prompt(`This action requires that you authorize through ${domain}, which will DISCARD YOUR CURRENT INPUTS\nType 'yes' to proceed`) == "yes") {
                    window.location.href = url;
                }
            }

            async function igSearch() {
                event.currentTarget.toggleAttribute("disabled", true);
                event.currentTarget.value = "Fetching...";
                var t = event.currentTarget;
                var response = await fetch("/api/republisher/ig", {
                    redirect: "manual"
                });
                t.toggleAttribute("disabled", false);
                console.log(response, response.headers.get("location"));
                if(response.ok) {
                    var html = await response.text();
                    document.getElementById("instaPosts").innerHTML = html;
                    t.style.display = "none";
                } else {
                    var loc = response.headers.get("location");
                    if(loc) {
                        redirectErr(loc);
                    } else {
                        var body = await response.text();
                        console.error(body);
                        alert("An error occured.");
                    }
                }
            }
        </script>
    </body>
</html>