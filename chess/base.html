<!DOCTYPE html>
<head>
    <title>Chess Tournament Leaderboard</title>
    <link rel="stylesheet" type="text/css" href="/css">
    <style>
        #admin {
            border: red 1px;
            margin: 1px;
            background-color: lightcoral;
        }
        .header {
            font-size: x-large;
            font-weight: bold;
            float: left;
        }
        div p {
            width: 100%;
            height: 100%;
            margin-top: 0;
            text-align: center;
        }
        #popupmain {
            position:fixed;
            padding:0;
            margin:0;
            text-align: center;
            top:1%;
            left:1%;
            font-size: xx-large;

            width: 98%;
            height: 98%;
            background:rgb(255, 136, 0);
        }
        #popupmain p {
            width: 100%;
            height: 50px;
        }
    </style>
</head>
<body>
    <div id='popupmain'>
        <h1>Notice of Official Rule Change</h1>
        <h2>This Leaderboard now uses the offical FIDE Laws of Chess</h2>
        <p>These rules are as expected similar to how you would have played before, but some are ignored, for example:</p>
        <ul>
            <li>The use of a chessclock is not required though it is encouraged to speed up play.</li>
            <li>The use of a scoresheet is not required, an issue may be raised to any Tournament Moderator at any time</li>
        </ul>
        <p>Other exemptions are in the Terms and Conditions.</p>
        <br/>
        <a href="#" onclick="setHideCookie('main');">Click here to close, once majority have read</a>
    </div>
    <div style="height: 35px;display: grid;grid-auto-flow: column;grid-template-columns: 25% 50% 25%;">
        <label class="header">Chess Leaderboard</label>
        <div id="admin" style="display: <REPLACE id='admin'/>;vertical-align: middle;align-items: center;justify-content: center;">
            <input type="button" value="Create New User" onclick="newuser();" style="margin-left: 5px; width: 30%; height: 20px;">
            <input type="button" value="Modify User" onclick="moduser();" style="margin-left: 5px; width: 30%; height: 20px;">
            <input type="button" value="Update Rankings" onclick="matchend();" style="width: 30%; height: 20px;">
        </div>
        <REPLACE id='loginBtn'/>
    </div>
    <div id="popup1" style="background: lightsalmon; width:100%; height:50px; border: 2px black solid; padding: 2px;">
        <p><strong><a href="/chess/terms">Chess Terms and Conditions are now in affect</a></strong>
            <br><a href="#" onclick="setHideCookie('1');">Click here to close</a>
        </p>
    </div>
    <div id="popup2" style="margin-top:10px; background: lightgreen; width:100%; height:50px; border: 2px black solid; margin-bottom: 10px;">
        <p><strong><a href="/chess/coa">Chess Court of Appeals is now open to hear any issues</a></strong>
            <br><a href="#" onclick="setHideCookie('2');">Click here to close</a>
        </p>
    </div>
    <div id="popup3" style="margin-top:10px; background: rgb(0, 225, 255); width:100%; height:50px; border: 2px black solid; margin-bottom: 10px;">
        <p><strong><a href="/chess/clock">A Chess Clock is available for use on a horizonal phone screen</a></strong>
            <br><a href="#" onclick="setHideCookie('3');">Click here to close</a>
        </p>
    </div>
    <table>
        <tr><th>Position</th><th>Score</th><th>Name</th><th>W/L %</th><th>W/L Raw</th></tr>
        <REPLACE id="table"/>
    </table>
    <hr style="margin-top: 15px;">
    <ul>
        <li><a href='/chess/terms'>Chess Terms and Conditions</a></li>
        <li><a href='/chess/coa'>Chess Court of Appeals - Appeal a punishment, technical modification or something else</a></li>
        <li><a href='/chess/clock?seconds=300'>Chess Clock - 5 minutes each player</a>
            <ul>
                <li><a href='/chess/clock?seconds=420'>Chess Clock - 7 minutes each player</a></li>
                <li><a href='/chess/clock?seconds=600'>Chess Clock - 10 minutes each player</a></li>
            </ul>
        </li>
    </ul>

    <script>
        function newuser() {
            var name = prompt("Enter new person's name");
            if(name == null || name == "") {
                // cancelled
            } else {
                fetch("/chess/api/player?name=" + name, 
                    {"method": "PUT"}
                )
                .then(function (response) {
                    if(response.ok) {
                        setTimeout(function reload() {
                            window.location.replace(window.location);
                        }, 1000);
                    } else {
                        response.text().then(function r(t) {alert(t);});
                    }
                })
                .catch(function(r){alert(r);});
            }
        }

        function matchend() {
            window.location.replace("/chess/match");
        }

        function moduser() {
            window.location.replace("/chess/userlist");
        }

        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays*24*60*60*1000));
            var expires = "expires="+ d.toUTCString();
            document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
        }

        function setHideCookie(id) {
            document.getElementById("popup" + id).style.display = "none";
            setCookie(id, "hide-popup", 180);
        }

        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function hideOtherPopups() {
            var x = document.cookie.split(";");
            console.log(x);
            for(var i = 0; i < x.length; i++) {
                var full = x[i];
                var start = 0;
                if(full[0] === " ")
                    start = 1;
                var name = full.substring(start, full.indexOf("="));
                var value = getCookie(name);
                console.log(name)
                console.log(value)
                if(value === "hide-popup") {
                    var thing = document.getElementById("popup" + name);
                    if(thing) {
                        thing.style.display = "none";
                    }
                }
            }
        }
        hideOtherPopups();
    </script>
</body>