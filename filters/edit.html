<!DOCTYPE html>
<html>
    <head>
        <title>Edit filter</title>
        <style>
            div {
                width: 100%;
            }
            #top-bit {
                height: 10%;
            }
            #bottom-bit {
                height: 90%;
            }
            #text {
                width: 100%;
                height: 100%;
            }
            input[value="Delete"] {
                background-color: rgb(255, 0, 0);
            }
            input[value="Copy"] {
                background-color: rgb(0, 255, 55);
            }
        </style>
    </head>
    <body>
        <div id="container">
            <div id="top-bit">
                <h1>Filter:</h1>
                <input type="button" value="Save" onclick="save()">
                <input type="button" value="Delete" onclick="del()">
                <input type="button" value="Copy" onclick="cpy()">
            </div>
            <hr>
            <div id="bottom-bit">
                <textarea id="text"></textarea>
            </div>
        </div>
        

        <script>
            var textarea = document.getElementById("text");
            function getId() {
                return window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1);
            }
            async function load() {
                const ID = getId();
                var response = await fetch(`/filters-raw/${ID}`);
                var body = await response.text();
                if(!response.ok) {
                    console.error("Error: ", response, body);
                    textarea.value = ":Error: " + body;
                    return;
                }
                textarea.value = body;
            }
            async function save() {
                const ID = getId();
                textarea.setAttribute("readonly", "")
                var response = await fetch(`/filters-raw/${ID}`, {
                    method: "POST",
                    body: textarea.value
                });
                var body = await response.text();
                if(!response.ok) {
                    console.error("Error: ", response, body);
                    alert("Failed to save!");
                } else {
                    textarea.removeAttribute("readonly");
                }
            }
            async function del() {
                var response = await fetch("/filters/" + getId(), {
                    method: "DELETE"
                });
                if(response.redirected) {
                    window.location.href = response.url;
                }
            }
            async function cpy() {
                var name = window.location.href.replace('/filters/', '/filters-raw/');
                await navigator.clipboard.writeText(name);
            }
            load();
        </script>
    </body>
</html>